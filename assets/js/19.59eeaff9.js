(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{184:function(t,s,e){t.exports=e.p+"assets/img/screenshot-plesk-login.a0a7367d.png"},185:function(t,s,e){t.exports=e.p+"assets/img/screenshot-postman-authorization-header.a049c04a.png"},186:function(t,s,e){t.exports=e.p+"assets/img/screenshot-plesk-main-panel.b9a5c968.png"},187:function(t,s,e){t.exports=e.p+"assets/img/screenshot-cyberduck-connection.99723c29.png"},188:function(t,s,e){t.exports=e.p+"assets/img/screenshot-cyberduck-security-warning.a677fd82.png"},189:function(t,s,e){t.exports=e.p+"assets/img/screenshot-cyberduck-login.098c1985.png"},190:function(t,s,e){t.exports=e.p+"assets/img/screenshot-cyberduck-root-folder.404a3975.png"},191:function(t,s,e){t.exports=e.p+"assets/img/screenshot-finder-file-selection.964b3266.png"},192:function(t,s,e){t.exports=e.p+"assets/img/screenshot-plesk-node-app.70f9fd8d.png"},193:function(t,s,e){t.exports=e.p+"assets/img/screenshot-plesk-node-app-npm.71b9e878.png"},251:function(t,s,e){"use strict";e.r(s);var a=[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("Assignment Reminder")]),this._v(" "),s("p",[this._v("Final project - Shopping Cart - is due by "),s("strong",[this._v("11:59 April 26, 2019")]),this._v(".")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"errata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#errata","aria-hidden":"true"}},[this._v("#")]),this._v(" ERRATA")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"jwt-client-headers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwt-client-headers","aria-hidden":"true"}},[this._v("#")]),this._v(" JWT Client Headers")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{pre:!0},[e("p",[t._v("The previous instructions for sending the JWT in request headers was not formatted correctly. The correct header key is "),e("code",[t._v("Authorization")]),t._v(" not "),e("code",[t._v("bearer")]),t._v(". The corresponding value should take the form of "),e("code",[t._v("Bearer {{token}}")]),t._v(", where "),e("code",[t._v("{{token}}")]),t._v(" is a placeholder for the actual token. Note the word Bearer is capitalized and followed be a space.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(185),alt:"screenshot of Postman showing the Authorization header"}})])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// Create a Headers object with the 'Content-Type' set to JSON")]),t._v("\n"),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" headers "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{attrs:{class:"token class-name"}},[t._v("Headers")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nheaders"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("append")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'application/json;charset=UTF-8'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{attrs:{class:"token comment"}},[t._v("// Set the 'Authorization' header if we have a token")]),t._v("\n"),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("authToken"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  headers"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("append")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'Authorization'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'Bearer '")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" authToken"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authenticate-middleware"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authenticate-middleware","aria-hidden":"true"}},[this._v("#")]),this._v(" Authenticate middleware")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Naturally, we now need to extract and validate the JWT from the request headers a little differently. Not only has the name of the header key changed from "),s("code",[this._v("bearer")]),this._v(" to "),s("code",[this._v("Authorization")]),this._v(", but the value is now a string with two parts.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" header"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("split")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("' '")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"previous-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#previous-code","aria-hidden":"true"}},[this._v("#")]),this._v(" Previous code")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("header")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'bearer'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("token"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("next")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{attrs:{class:"token class-name"}},[t._v("NotAuthenticatedException")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'Missing bearer token'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{attrs:{class:"token comment"}},[t._v("// ... rest of the module")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"updated-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#updated-code","aria-hidden":"true"}},[this._v("#")]),this._v(" Updated code")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{attrs:{class:"token function-variable function"}},[t._v("parseToken")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("header"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("header"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" header"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("split")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("' '")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),e("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'Bearer'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" token "),e("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'undefined'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" token\n    "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" undefined\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("parseToken")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function"}},[t._v("header")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'Authorization'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("token"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("next")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{attrs:{class:"token class-name"}},[t._v("NotAuthenticatedException")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'Missing bearer token'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{attrs:{class:"token comment"}},[t._v("// ... rest of the module")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"hosted-mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hosted-mongodb","aria-hidden":"true"}},[this._v("#")]),this._v(" Hosted MongoDB")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"credentials"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#credentials","aria-hidden":"true"}},[this._v("#")]),this._v(" Credentials")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"mongodb-connection-string"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-connection-string","aria-hidden":"true"}},[this._v("#")]),this._v(" MongoDB Connection String")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("mongodb://hostname:port/database-name\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("mongodb://localhost:27017/mad9124\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"production-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#production-server","aria-hidden":"true"}},[this._v("#")]),this._v(" Production server")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The "),s("code",[this._v("hostname")]),this._v(" for the production database is "),s("code",[this._v("mongodb.mad9124.rocks")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("In addition to a different "),s("code",[this._v("hostname")]),this._v(", the production server requires use to specify a "),s("code",[this._v("username")]),this._v(" and "),s("code",[this._v("password")]),this._v(" pair along with the name of the authentication database where the credentials are stored. The connection string should now follow this pattern.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("mongodb://username:password@hostname:27017/database-name?authSource=admin\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"update-the-connectdatabase-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#update-the-connectdatabase-module","aria-hidden":"true"}},[this._v("#")]),this._v(" Update the "),s("code",[this._v("ConnectDatabase")]),this._v(" Module")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Remember we are retrieving the configuration variables using the "),s("code",[this._v("config.get()")]),this._v(" method. You will need to create a new "),s("code",[this._v("/config/production.json")]),this._v(" file with your credtentials. e.g.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{attrs:{class:"token property"}},[t._v('"db"')]),e("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token property"}},[t._v('"host"')]),e("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v('"mongodb.mad9124.rocks"')]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{attrs:{class:"token property"}},[t._v('"username"')]),e("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v('"mckennr"')]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{attrs:{class:"token property"}},[t._v('"password"')]),e("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v('"supeRsecreTpassworD"')]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{attrs:{class:"token property"}},[t._v('"name"')]),e("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v('"final-mckennr"')]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Then in the "),s("code",[this._v("/startup/connectDatabase.js")]),this._v(" module, we need to conditionally add the login credentials to the connection string if "),s("code",[this._v("NODE_NEV")]),this._v(" is set to "),s("code",[this._v("production")]),this._v(".")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("require")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'config'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" logger "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("require")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'./logger'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("require")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'mongoose'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" db "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token keyword"}},[t._v("get")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'db'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" credentials "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("''")]),t._v("\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'production'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    credentials "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token template-string"}},[e("span",{attrs:{class:"token string"}},[t._v("`")]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("db"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token string"}},[t._v(":")]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("db"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token string"}},[t._v("@`")])]),t._v("\n  "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" connectionString "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token template-string"}},[e("span",{attrs:{class:"token string"}},[t._v("`mongodb://")]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("credentials"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("db"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token string"}},[t._v(":")]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("db"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token string"}},[t._v("/")]),e("span",{attrs:{class:"token interpolation"}},[e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("db"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),e("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{attrs:{class:"token string"}},[t._v("?authSource=admin`")])]),t._v("\n\n"),e("span",{attrs:{class:"token comment"}},[t._v("// ... rest of the module is unchanged.")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),s("p",[this._v("Don't forget we need to make sure that the NODE_ENV environment variable gets set to "),s("code",[this._v("production")]),this._v(" on our production deployment. We will set this a little later in the Edumedia control panel.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"deploy-to-edumedia"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-to-edumedia","aria-hidden":"true"}},[this._v("#")]),this._v(" Deploy to Edumedia")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"replace-bcrypt-with-bcryptjs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#replace-bcrypt-with-bcryptjs","aria-hidden":"true"}},[this._v("#")]),this._v(" Replace bcrypt with bcryptjs")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" uninstall bcrypt\n"),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" bcryptjs\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Then in "),s("code",[this._v("/models/User.js")]),this._v(", you will need to change the require statement to load the new module.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bcrypt "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token function"}},[t._v("require")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'bcryptjs'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"login-to-control-panel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#login-to-control-panel","aria-hidden":"true"}},[this._v("#")]),this._v(" Login to control panel")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(186),alt:"screenshot of Plesk main panel"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"ftp-to-root-folder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ftp-to-root-folder","aria-hidden":"true"}},[this._v("#")]),this._v(" FTP to root folder")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(187),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(188),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(189),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("You should now be logged-in to edumedia.ca via FTP. Make sure that the current folder is set to the root of your user acocunt i.e. "),s("code",[this._v("/")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(190),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),s("p",[this._v("Do not copy the "),s("code",[this._v("node_modules")]),this._v(" folder or the "),s("code",[this._v("package-lock.json")]),this._v(" file.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(191),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"setup-the-node-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-the-node-application","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup the Node application")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(192),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"node-js-version"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-js-version","aria-hidden":"true"}},[this._v("#")]),this._v(" Node.js Version")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Select version "),s("code",[this._v("9.10.1")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"document-root"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#document-root","aria-hidden":"true"}},[this._v("#")]),this._v(" Document Root")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Select "),s("code",[this._v("/httpdocs")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"application-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-mode","aria-hidden":"true"}},[this._v("#")]),this._v(" Application Mode")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Edumedia uses Passenger Phusion to run our Node apps. Leave this setting at "),s("code",[this._v("development")]),this._v(" to be able to see error message if there are any. You will not have access to the console.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"application-url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-url","aria-hidden":"true"}},[this._v("#")]),this._v(" Application URL")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("This should be in the form of http://username.edumedia.ca where "),s("code",[this._v("username")]),this._v(" is your Algonquin username that you used to login to the control panel.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"application-root"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-root","aria-hidden":"true"}},[this._v("#")]),this._v(" Application Root")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("This must be "),s("code",[this._v("/")]),this._v(". This is where you uploaded your project files with FTP.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"application-startup-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-startup-file","aria-hidden":"true"}},[this._v("#")]),this._v(" Application Startup File")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("This should be the main entry point for your API server. i.e. "),s("code",[this._v("app.js")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"custom-environment-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-environment-variables","aria-hidden":"true"}},[this._v("#")]),this._v(" Custom environment variables")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("This is where we will set any environement variables that you might need to reference in your code. Click the "),e("code",[t._v("[specify]")]),t._v(" link and then add the "),e("code",[t._v("key")]),t._v(" : "),e("code",[t._v("value")]),t._v(" pairs. At the minimum, you will need to set "),e("code",[t._v("APP_JWTKEY")]),t._v(" and "),e("code",[t._v("NODE_ENV")]),t._v(". To generate a random string for the JWT secret key, you can use the genKey.js script that I gave you in week 11, or you can run this command in the terminal.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("openssl rand -base64 30\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("table",[e("thead",[e("tr",[e("th",[t._v("key")]),t._v(" "),e("th",[t._v("value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("APP_JWTKEY")]),t._v(" "),e("td",[t._v("PJ20vdDET6/8QmSE7VkYiGN1FIuOmjFYKN3gRbZ9")])]),t._v(" "),e("tr",[e("td",[t._v("NODE_ENV")]),t._v(" "),e("td",[t._v("production")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"npm-install"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#npm-install","aria-hidden":"true"}},[this._v("#")]),this._v(" NPM install")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("With Edumedia, you do not have access to the command line environment. Near the top of the screen there is a button to let you run "),s("code",[this._v("NPM install")]),this._v(". Click on that. It may take a short time to complete. When it is done, click on the "),s("code",[this._v("Restart App")]),this._v(" button.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(193),alt:"screenshot highlighting NPM install button on plesk node app"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"port-80"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#port-80","aria-hidden":"true"}},[this._v("#")]),this._v(" Port 80")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("You should now be able to run your Postman tests by setting the URL in Postman to "),s("code",[this._v("http://your-username.edumedia.ca")]),this._v(". Note that the Edumedia server is running an Apache web server in front of your application as a reverse proxy. The port that you should use with Postman and in your client application is port 80.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"for-next-week"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#for-next-week","aria-hidden":"true"}},[this._v("#")]),this._v(" For next week")])}],n=e(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("WeekHeader",{attrs:{number:13,title:"Production Deployment"}}),t._v(" "),a("div",{staticClass:"danger custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("Quiz 9: Production Prep "),a("Badge",{attrs:{text:"15 mins"}})],1),t._v(" "),a("p",[t._v("There will be a quiz today. It will be worth 2% of your final grade.")])]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("In Postman it looks like this ...")]),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("In your JavaScript client app it would look like this ...")]),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("The first part is the token type "),a("code",[t._v("Bearer")]),t._v(" and the second part – after the space – is the actual token. We can use JavaScript's "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split",target:"_blank",rel:"noopener noreferrer"}},[t._v("String.prototype.split()"),a("OutboundLink")],1),t._v(" to issolate these two values as elements of an array. Then we can apply "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment",target:"_blank",rel:"noopener noreferrer"}},[t._v("destructuring assignment"),a("OutboundLink")],1),t._v(" to to extract the first two elements of the array into local variables, "),a("code",[t._v("type")]),t._v(" and "),a("code",[t._v("token")]),t._v(".")]),t._v(" "),t._m(8),a("p",[t._v("To keep things clean and organized, let's move the logic to parse the Authorization header into a separate function.")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),a("p",[t._v("I have deployed a shared MongoDB server container running on an AWS Lightsail VPS. Each project team has been assigned unique login credentials that have access restricted to their own private database.")]),t._v(" "),t._m(14),t._v(" "),a("p",[t._v("You will receive an email with the connection details for your project team.")]),t._v(" "),t._m(15),t._v(" "),a("p",[t._v("Up until now, the connection string to tell Mongoose how to open a connection to the database took this format:")]),t._v(" "),t._m(16),a("p",[t._v("e.g.")]),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("You will host your final web service API application code with your Edumedia account. However, the Edumedia server's node.js environment has a configuration that causes a the "),a("code",[t._v("bcrypt")]),t._v(" module's installation to fail. As a work-around, we will replace this module with the "),a("a",{attrs:{href:"https://www.npmjs.com/package/bcryptjs",target:"_blank",rel:"noopener noreferrer"}},[t._v("bcryptjs"),a("OutboundLink")],1),t._v(" module, which is 100% API compatible but runs about 30% slower.")]),t._v(" "),a("p",[t._v("In your project folder on your laptop, run these terminal commands.")]),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),a("p",[t._v("Save your changes.")]),t._v(" "),t._m(33),t._v(" "),a("p",[t._v("Go to "),a("a",{attrs:{href:"https://edumedia.ca:8443",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://edumedia.ca:8443"),a("OutboundLink")],1),t._v(" to login to the hosting admin panel. You will see a login form.")]),t._v(" "),a("img",{staticClass:"screenshot",staticStyle:{"max-width":"400px",margin:"0 20%"},attrs:{src:e(184),alt:"screenshot of Plesk login dialog"}}),t._v(" "),a("p",[t._v('Use your Algonquin user name (e.g. mine is mckennr). If you have not logged-in before or cannot remember your password, click the "Forgot your password?" link and they will send you a reset link to your Algonquin email.')]),t._v(" "),a("p",[t._v("Once you are logged-in, you will see the main control panel. It should look similar to this.")]),t._v(" "),t._m(34),t._v(" "),a("p",[t._v("We will come back to this in just a minute.")]),t._v(" "),t._m(35),t._v(" "),a("p",[t._v("Now that you have verified that you can login to the Edumedia server, use your favourite FTP client application (CyberDuck, Filezilla, etc.) to login. I will use CyberDuck for this example.")]),t._v(" "),a("p",[t._v("Create a new server connection ...")]),t._v(" "),t._m(36),t._v(" "),a("p",[t._v("Then double click the new connection to login. You may see a security warning ...")]),t._v(" "),t._m(37),t._v(" "),a("p",[t._v("Just click continue and enter your password when prompted.")]),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),a("p",[t._v('Now you can "drag and drop" your project files into the root folder on your Edumedia account.')]),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),a("p",[t._v('Once the FTP upload is complete, you can go back to the Plesk control panel in your browser. Click on the "Node.js" link near the middle of the page.')]),t._v(" "),a("p",[t._v("You need to configure the options on this page carefully. When you are done, it should look similar to mine.")]),t._v(" "),t._m(44),t._v(" "),a("p",[t._v("Let's take these settings one at a time.")]),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),a("p",[t._v("Before next week's class, please read these additional online resources.")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/docker-overview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker overview"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=YFl2mCHdv24",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn Docker in 12 Minutes"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=Qw9zlE3t8Ko",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Compose in 12 Minutes"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=F82K07NmRpk",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deploy Docker Containers with Docker Cloud"),a("OutboundLink")],1)])])],1)},a,!1,null,null,null);r.options.__file="README.md";s.default=r.exports}}]);